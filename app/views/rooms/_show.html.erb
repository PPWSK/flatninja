<% if local_assigns.has_key? :local_room %>
  <% room = local_room %>
<% end %>
<% if local_assigns.has_key? :local_user %>
  <% user = local_user %>
<% end %>

<div class="card">
  <div class="card-image" id="main-content">
    <div class="row">

      <% room.room_pictures.each do |rpic| %>
        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 img-wrap">

          <%= image_tag rpic.file.url(:medium), class: "img-responsive" %>

        </div>
      <% end %>
      <% if room.room_pictures.size == 0 %>
        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
          <%= image_tag "empty.png", class: "img-responsive" %>
        </div>
      <% end %>
    </div>

    <span class="card-title"><strong><%= room.optional_name %></strong></span>

  </div>

  <div class="card-content">
    <div class="row">

      <!-- ROOMS FORM -->
      <div class="card-image col-sm-10 col-sm-offset-1">
        <div class="row form-inputs">

          <!-- price & availabilities -->

          <div class="col-sm-7">
            <div class="row">
              <strong>Price:</strong>
              <span class="<%= 'missing' if !room.price.present? %>"><%= room.price %>&nbsp;Eur / month</span>
            </div>
            <div class="row">
              <strong>Surface:</strong>
              <span class="<%= 'missing' if !room.square_meter.present? %>"><%= room.square_meter.to_s %>&nbsp;Sqm</span>
            </div>
            <div class="row">
              <strong>Available from:</strong>
              <span class="<%= 'missing' if !room.available_from.present? %>"><%= room.available_from %>&nbsp;</span>
            </div>
            <div class="row">
              <strong>For maximum:</strong>
              <span class="<%= 'missing' if !room.months_available.present? %>"><%= room.months_available %>&nbsp;months</span>
            </div>
          </div>

          <!-- attributes -->

          <div class="col-sm-4 col-sm-offset-1">
            <div class="row">

              <%= room.private_bathroom ? ("<i class='fa fa-check fa-1x' style='color: green;'></i>").html_safe : ("<i class='fa fa-times fa-1x' style='color: black;'></i> No").html_safe %>
              Private Bathroom

            </div>
            <div class="row">
              <%= room.private_kitchen ? ("<i class='fa fa-check fa-1x' style='color: green;'></i>").html_safe : ("<i class='fa fa-times fa-1x' style='color: black;'></i> No").html_safe %>
              Private Kitchen
            </div>
            <div class="row">
              <%= room.private_balcony ? ("<i class='fa fa-check fa-1x' style='color: green;'></i>").html_safe : ("<i class='fa fa-times fa-1x' style='color: black;'></i> No").html_safe %>
              Private Balcony
            </div>
            <div class="row">
              <%= room.private_garden ? ("<i class='fa fa-check fa-1x' style='color: green;'></i>").html_safe : ("<i class='fa fa-times fa-1x' style='color: black;'></i> No").html_safe %>
              Private Garden
            </div>
            <div class="row">
              <%= room.private_parking ? ("<i class='fa fa-check fa-1x' style='color: green;'></i>").html_safe : ("<i class='fa fa-times fa-1x' style='color: black;'></i> No").html_safe %>
              Private Parking
            </div>
          </div>
        </div>
        <div class="row">
          <% if room.published_room %>
              <span><i class='fa fa-toggle-on fa-1x' style="color:green"></i>&nbsp;&nbsp;Room is published and visible for searchers</span>
          <% elsif room.valid_room %>
              <span><i class='fa fa-toggle-off fa-1x' style="color:orange"></i>&nbsp;&nbsp;Room is valid and ready for publishing</span>
          <% else %>
              <span><i class='fa fa-toggle-off fa-1x' style="color:red"></i>&nbsp;&nbsp;Room must be edited in order to be published...</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="card-action">

  <!-- user signed in -->
  <% if account_signed_in? && current_account.user.present? %>

    <!-- room is from current account -->
    <% if current_account.user == room.building.user %>


      <!-- edit -->

      <%= link_to ("<i class='fa fa-pencil-square-o fa-1x'>&nbsp;&nbsp;Edit</i>").html_safe, edit_user_building_room_path(current_account.user, room.building, room) %>

      <!-- publish if room is valid -->

      <% if room.published_room %>

      <!-- un-publish -->

        <%= link_to ("<i class='fa fa-share-square-o fa-1x card-action-negative'>&nbsp;&nbsp;Un-publish</i>").html_safe, unpublish_user_building_room_path(current_account.user, room.building, room), :confirm => "Are you sure? This room won't be visibile to users anymore..." if room.published_room %>

      <% else %>

        <!-- publish -->

        <%= link_to ("<i class='fa fa-share-square-o fa-1x'>&nbsp;&nbsp;Publish</i>").html_safe, publish_user_building_room_path(current_account.user, room.building, room) if room.valid_room %>

      <% end %>

    <!-- room is from someone else -->
    <% else %>
      <div class="row">

        <!-- positive evaluation -->

        <div class="col-sm-6 like-it">
        <%= link_to ("<i class='fa fa-heart fa-4x' style='color: red;'></i>").html_safe,  user_building_room_evaluations_path(current_account.user, room.building, room, eval: true), method: :post %>
        </div>

        <!-- negative evaluation -->

        <div class="col-sm-6 like-it">
        <%= link_to ("<i class='fa fa-times fa-4x' style='color: black;'></i>").html_safe,  user_building_room_evaluations_path(current_account.user, room.building, room, eval: false), method: :post %>
        </div>
      </div>

    <% end %>

  <!-- no user signed in -->

  <% else %>

    <div class="row">
      <div class="col-sm-6 like-it">
      <%= link_to ("<i class='fa fa-heart fa-4x' style='color: gray;'></i>").html_safe, "#" %>
      </div>
      <div class="col-sm-6 like-it">
      <%= link_to ("<i class='fa fa-times fa-4x' style='color: gray;'></i>").html_safe, "#" %>
      </div>
    </div>

  <% end %>

  </div>

</div>
